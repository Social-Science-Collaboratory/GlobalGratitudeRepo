mutate(effect_size = effect_size)
return(d.c)
})
View(d.c)
d.c <- bind_rows(d.c)
View(d.c)
View(d.c)
d.c <- d.c %>% select(-y, -label)
View(d.c)
country_results <- df %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,
TRUE                            ~ m < 0
)
) %>%
filter(is_negative) %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country, collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
country_results <- d.c %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,
TRUE                            ~ m < 0
)
) %>%
filter(is_negative) %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country, collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
country_results <- d.c %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,
TRUE                            ~ m < 0
)
) %>%
filter(is_negative) %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country, collapse = "/n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
View(d.c)
country_results <- d.c %>%
mutate(
na = case_when(
effect_size == "na_effect_size" ~ m > 0,
TRUE                            ~ m < 0
)
) %>%
filter(na) %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = country,
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
country_results <- d.c %>%
mutate(
na = case_when(
effect_size == "na_effect_size" ~ m > 0,
TRUE                            ~ m < 0
)
) %>%
filter(na) %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country),
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
country_results <- d.c
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country, collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
View(d.c)
country_results <- d.c %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country, collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
country_results <- d.c %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,  # Reverse logic for NA
TRUE                            ~ m < 0
)
) %>%
filter(is_negative) %>%
group_by(effect_size) %>%
summarise(
n_countries = n(),
countries = str_c(country, collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
View(country_results)
country_results <- d.c %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,  # Reverse logic for NA
TRUE                            ~ m < 0
)
)
View(country_results)
country_results <- country_results %>%
group_by(effect_size) %>%
summarise(
n_countries_negative = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
n_countries_negative = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
mutate_country_results <- d.c %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,  # Reverse logic for NA
TRUE                            ~ m < 0
)
)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
n_countries_negative = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size)
print(country_results)
View(country_results)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
countries_count = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size) %>%
mutate(
outcome = recode(
effect_size,
"pa_effect_size"         = "PA",
"na_effect_size"         = "NA",
"optimistic_effect_size" = "Optimism",
"ls_effect_size"         = "Life Satisfaction",
"envy_effect_size"       = "Envy",
"indebted_effect_size"   = "Indebtedness"
)
)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
countries_count = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size) %>%
mutate(
outcome = recode(
outcome,
"pa_effect_size"         = "PA",
"na_effect_size"         = "NA",
"optimistic_effect_size" = "Optimism",
"ls_effect_size"         = "Life Satisfaction",
"envy_effect_size"       = "Envy",
"indebted_effect_size"   = "Indebtedness"
)
)
print(country_results)
print(distribution_results)
# Compute probability > 0
effect_prob <- function(effect_name, reverse = FALSE) {
mean_val <- m.ic[[effect_name]][["b"]]
sd_val <- sqrt(m.ic[[effect_name]][["sigma2"]][[2]])
prob <- pnorm(q = 0, mean = mean_val, sd = sd_val) * 100
if (reverse) prob else 100 - prob
}
# Create the table
distribution_results <- data.frame(
outcome = c("PA", "NA", "Optimism", "Life Satisfaction", "Envy", "Indebtedness"),
distribution = c(
effect_prob("pa_effect_size"),
effect_prob("na_effect_size", reverse = TRUE),  # NA not subtracted from 100
effect_prob("optimistic_effect_size"),
effect_prob("ls_effect_size"),
effect_prob("envy_effect_size"),
effect_prob("indebted_effect_size")
)
) %>%
rename(`distribution (in opposite direction)` = distribution)
print(distribution_results)
#combine
final_df <- rbind(distribution_results, country_results)
# Compute probability > 0
effect_prob <- function(effect_name, reverse = FALSE) {
mean_val <- m.ic[[effect_name]][["b"]]
sd_val <- sqrt(m.ic[[effect_name]][["sigma2"]][[2]])
prob <- pnorm(q = 0, mean = mean_val, sd = sd_val) * 100
if (reverse) prob else 100 - prob
}
# Create the table
distribution_results <- data.frame(
outcome = c("PA", "NA", "Optimism", "Life Satisfaction", "Envy", "Indebtedness"),
Distribution = c(
effect_prob("pa_effect_size"),
effect_prob("na_effect_size", reverse = TRUE),  # NA not subtracted from 100
effect_prob("optimistic_effect_size"),
effect_prob("ls_effect_size"),
effect_prob("envy_effect_size"),
effect_prob("indebted_effect_size")
)
)
print(distribution_results)
# Compute probability > 0
effect_prob <- function(effect_name, reverse = FALSE) {
mean_val <- m.ic[[effect_name]][["b"]]
sd_val <- sqrt(m.ic[[effect_name]][["sigma2"]][[2]])
prob <- pnorm(q = 0, mean = mean_val, sd = sd_val) * 100
if (reverse) prob else 100 - prob
}
# Create the table
distribution_results <- data.frame(
outcome = c("PA", "NA", "Optimism", "Life Satisfaction", "Envy", "Indebtedness"),
distribution = c(
effect_prob("pa_effect_size"),
effect_prob("na_effect_size", reverse = TRUE),  # NA not subtracted from 100
effect_prob("optimistic_effect_size"),
effect_prob("ls_effect_size"),
effect_prob("envy_effect_size"),
effect_prob("indebted_effect_size")
)
)
print(distribution_results)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
countries_count = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size) %>%
mutate(
outcome = recode(
outcome,
"pa_effect_size"         = "PA",
"na_effect_size"         = "NA",
"optimistic_effect_size" = "Optimism",
"ls_effect_size"         = "Life Satisfaction",
"envy_effect_size"       = "Envy",
"indebted_effect_size"   = "Indebtedness"
)
)
print(country_results)
#combine
final_results <- left_join(distribution_results, country_results, by = "Outcome")
#combine
final_results <- left_join(distribution_results, country_results, by = "outcome")
View(final_results)
# PA
100 -
pnorm(q = 0,
mean = m.ic[["pa_effect_size"]][["b"]],
sd = m.ic[["pa_effect_size"]][["sigma2"]][[2]] %>%
sqrt()
) * 100
# NA (note reverse direction -- i.e., not subtracted from 100)
pnorm(q = 0,
mean = m.ic[["na_effect_size"]][["b"]],
sd = m.ic[["na_effect_size"]][["sigma2"]][[2]] %>%
sqrt()
) * 100
# optimism
100 -
pnorm(q = 0,
mean = m.ic[["optimistic_effect_size"]][["b"]],
sd = m.ic[["optimistic_effect_size"]][["sigma2"]][[2]] %>%
sqrt()
) * 100
# ls
100 -
pnorm(q = 0,
mean = m.ic[["ls_effect_size"]][["b"]],
sd = m.ic[["ls_effect_size"]][["sigma2"]][[2]] %>%
sqrt()
) * 100
# envy
100 -
pnorm(q = 0,
mean = m.ic[["envy_effect_size"]][["b"]],
sd = m.ic[["envy_effect_size"]][["sigma2"]][[2]] %>%
sqrt()
) * 100
# indebted
100 -
pnorm(q = 0,
mean = m.ic[["indebted_effect_size"]][["b"]],
sd = m.ic[["indebted_effect_size"]][["sigma2"]][[2]] %>%
sqrt()
) * 100
# Compute probability > 0
effect_prob <- function(effect_name, reverse = FALSE) {
mean_val <- m.ic[[effect_name]][["b"]]
sd_val <- sqrt(m.ic[[effect_name]][["sigma2"]][[2]])
prob <- pnorm(q = 0, mean = mean_val, sd = sd_val) * 100
if (reverse) prob else 100 - prob
}
# Create the table
distribution_results <- data.frame(
outcome = c("PA", "NA", "Optimism", "Life Satisfaction", "Envy", "Indebtedness"),
distribution = c(
effect_prob("pa_effect_size"),
effect_prob("na_effect_size", reverse = TRUE),  # NA not subtracted from 100
effect_prob("optimistic_effect_size"),
effect_prob("ls_effect_size"),
effect_prob("envy_effect_size"),
effect_prob("indebted_effect_size")
),
opposite_distribution = c(
effect_prob("pa_effect_size", reverse = TRUE),
effect_prob("na_effect_size"),  # NA not subtracted from 100
effect_prob("optimistic_effect_size", reverse = TRUE),
effect_prob("ls_effect_size", reverse = TRUE),
effect_prob("envy_effect_size", reverse = TRUE),
effect_prob("indebted_effect_size", reverse = TRUE)
))
print(distribution_results)
View(distribution_results)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
opposite_countries_count = sum(is_negative, na.rm = TRUE),
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size) %>%
mutate(
outcome = recode(
outcome,
"pa_effect_size"         = "PA",
"na_effect_size"         = "NA",
"optimistic_effect_size" = "Optimism",
"ls_effect_size"         = "Life Satisfaction",
"envy_effect_size"       = "Envy",
"indebted_effect_size"   = "Indebtedness"
)
)
print(country_results)
final_results <- left_join(distribution_results, country_results, by = "outcome")
View(d.c)
write.csv(final_results,
file = here('data',
"universality_data.csv"))
write.csv(final_results,
file = here('data',
"universality_data.csv"))
unique(df$lab)
unique(d.c$country)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
opposite_countries_count = sum(is_negative, na.rm = TRUE),
opposite_countries_prop = opposite_countries_count/34,
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size) %>%
mutate(
outcome = recode(
outcome,
"pa_effect_size"         = "PA",
"na_effect_size"         = "NA",
"optimistic_effect_size" = "Optimism",
"ls_effect_size"         = "Life Satisfaction",
"envy_effect_size"       = "Envy",
"indebted_effect_size"   = "Indebtedness"
)
)
print(country_results)
View(country_results)
#combine
final_results <- left_join(distribution_results, country_results, by = "outcome")
write.csv(final_results,
file = here('data',
"universality_data.csv"))
View(results_df)
View(results)
View(final_results)
View(final_results)
View(d.c)
View(mutate_country_results)
# Compute probability > 0
effect_prob <- function(effect_name, reverse = FALSE) {
mean_val <- m.ic[[effect_name]][["b"]]
sd_val <- sqrt(m.ic[[effect_name]][["sigma2"]][[2]])
prob <- pnorm(q = 0, mean = mean_val, sd = sd_val) * 100
if (reverse) prob else 100 - prob
}
# Create the table
distribution_results <- data.frame(
outcome = c("PA", "NA", "Optimism", "Life Satisfaction", "Envy", "Indebtedness"),
distribution = c(
effect_prob("pa_effect_size"),
effect_prob("na_effect_size", reverse = TRUE),
effect_prob("optimistic_effect_size"),
effect_prob("ls_effect_size"),
effect_prob("envy_effect_size", reverse = TRUE),
effect_prob("indebted_effect_size")
),
opposite_distribution = c(
effect_prob("pa_effect_size", reverse = TRUE),
effect_prob("na_effect_size"),
effect_prob("optimistic_effect_size", reverse = TRUE),
effect_prob("ls_effect_size", reverse = TRUE),
effect_prob("envy_effect_size"),
effect_prob("indebted_effect_size", reverse = TRUE)
))
print(distribution_results)
d.c <- lapply(effect_size_columns, function(effect_size) {
d.c <- df %>%
group_by(country) %>%
summarise(m = mean(.data[[effect_size]]), .groups = "drop") %>%
# add [jittered] y-value to assist with plotting
mutate(y = 0,
y = jitter(y, .1)) %>%
# labels most extreme observations (in terms of min and max)
mutate(label = if_else(m == min(m),
true = country,
false = ""),
label = if_else(m == max(m),
true = country,
false = label)) %>%
# include effect size name for reference
mutate(effect_size = effect_size)
return(d.c)
})
d.c <- bind_rows(d.c)
d.c <- d.c %>% select(-y, -label)
mutate_country_results <- d.c %>%
mutate(
is_negative = case_when(
effect_size == "na_effect_size" ~ m > 0,
effect_size == "envy_effect_size" ~ m > 0,
TRUE                            ~ m < 0
)
)
country_results <- mutate_country_results %>%
group_by(effect_size) %>%
summarise(
opposite_countries_count = sum(is_negative, na.rm = TRUE),
opposite_countries_prop = opposite_countries_count/34,
countries = str_c(country[is_negative], collapse = "\n"),
.groups = "drop"
) %>%
rename(outcome = effect_size) %>%
mutate(
outcome = recode(
outcome,
"pa_effect_size"         = "PA",
"na_effect_size"         = "NA",
"optimistic_effect_size" = "Optimism",
"ls_effect_size"         = "Life Satisfaction",
"envy_effect_size"       = "Envy",
"indebted_effect_size"   = "Indebtedness"
)
)
print(country_results)
#combine
final_results <- left_join(distribution_results, country_results, by = "outcome")
write.csv(final_results,
file = here('data',
"universality_data.csv"))
View(final_results)
#combine
final_results <- left_join(distribution_results, country_results, by = "outcome")
write.csv(final_results,
file = here('data',
"universality_data.csv"))
