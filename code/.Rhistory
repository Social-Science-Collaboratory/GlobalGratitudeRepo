library(cowplot)
plot_grid(fig3a,
ggdraw(),
fig3b,
labels = c("A", "", "B"),
nrow = 3,
rel_heights = c(.2, .05, .75),
rel_widths = c(.1, 1))
library(cowplot)
plot_grid(fig3a,
ggdraw(),
fig3b,
labels = c("a", "", "b"),
nrow = 3,
rel_heights = c(.2, .05, .75),
rel_widths = c(.1, 1))
universality_data.csv <- left_join(distribution_results, country_results, by = "outcome")
viz.DF <-
read.csv(here('data',
"universality_data.csv"),
na.strings = "N/A") %>%
# clean factors
mutate(outcome = factor(outcome,
levels = c("PA",
"Optimism",
"NA",
"Indebtedness",
"Life Satisfaction",
"Envy"),
labels = c("Positive affect",
"Optimism",
"Negative affect",
"Indebtedness",
"Life satisfaction",
"Envy")
),
countries = str_replace_all(countries,
"\n",
", ")
)
library(cowplot)
plot_grid(fig3a,
ggdraw(),
fig3b,
labels = c("a", "", "b"),
nrow = 3,
rel_heights = c(.2, .05, .75),
rel_widths = c(.1, 1))
# set up packages
library(here)
library(tidyverse)
library(qualtRics)
library(psych)
library(gridExtra)
library(lme4)
library(lmerTest)
library(emmeans)
library(gtools)
# allow for Type III Sums of Square
options(contrasts = c('contr.sum', 'contr.poly'))
library(tidyverse)
library(effsize)
library(ggplot2)
library(metafor)
library(scales)
library(ggtext)
library(Matrix)
library(ggtext)
library(tidyr)
library(sf)
library(here)
# specify directory
i_am("code/GlobalGratitude_Visualization.Rmd")
# fetch survey
DF <- readRDS(file = here("data", "GlobalGratitude_Final_Cleaned.Rds"))
DF <- DF %>%
rowwise() %>%
mutate(
# gratitude
gratitude_mean = mean(c(grateful, appreciative, thankful), na.rm = TRUE),
# positive affect
pa_mean = mean(c(happy, satisfied, content, joyful, pleased), na.rm = TRUE),
# optimism
optimistic_mean = mean(c(optimistic, hopeful), na.rm = TRUE),
# negative affect
na_mean = mean(c(sad, depressed, anxious, nervous), na.rm = TRUE),
# indebtedness
indebted_mean = mean(c(indebted, obligated), na.rm = TRUE),
# envy
envy_mean = mean(c(envious, bitter, jealous), na.rm = TRUE),
# life satisfaction
ls_mean = mean(c(ls_1, ls_2, ls_3, ls_4, ls_5), na.rm = TRUE),
# sense of self
ss_mean = mean(c(self_image, self_image_circle), na.rm = TRUE)
) %>%
ungroup() %>%
drop_na(gratitude_mean, pa_mean, optimistic_mean, na_mean,
indebted_mean, envy_mean, ls_mean, guilty, ladder, ss_mean)
DF <- DF %>%
mutate(country = case_when(
lab == "POL_01" ~ "Poland",
lab == "POL_02" ~ "Poland",
lab == "DNK_01" ~ "Denmark",
lab == "TUR_01" ~ "Turkey",
lab == "MYS_01" ~ "Malaysia",
lab == "USA_01" ~ "United States",
lab == "USA_02" ~ "United States",
lab == "USA_02b" ~ "United States",
lab == "USA_02c" ~ "United States",
lab == "NGA_01" ~ "Nigeria",
lab == "NGA_02" ~ "Nigeria",
lab == "CAN_01" ~ "Canada",
lab == "FRA_01" ~ "France",
lab == "AUS_01" ~ "Australia",
lab == "CHL_01" ~ "Chile",
lab == "DEU_01" ~ "Germany",
lab == "GRC_01" ~ "Greece",
lab == "HUN_01" ~ "Hungary",
lab == "ISR_01" ~ "Israel",
lab == "IRL_01" ~ "Ireland",
lab == "MEX_01" ~ "Mexico",
lab == "ITA_01" ~ "Italy",
lab == "PRT_01" ~ "Portugal",
lab == "BRA_01" ~ "Brazil",
lab == "NLD_01" ~ "Netherlands",
lab == "GBR_01" ~ "United Kingdom",
lab == "ESP_01" ~ "Spain",
lab == "ZAF_01" ~ "South Africa",
lab == "KOR_01" ~ "South Korea",
lab == "SWE_01" ~ "Sweden",
lab == "IND_01" ~ "India",
lab == "COL_01" ~ "Colombia",
lab == "CHN_01" ~ "China",
lab == "KAZ_01" ~ "Kazakhstan",
lab == "NOR_01" ~ "Norway",
lab == "JPN_01" ~ "Japan",
lab == "GHA_01" ~ "Ghana",
lab == "THA_01" ~ "Thailand",
lab == "MKD_01" ~ "Macedonia",
TRUE ~ NA_character_
)) %>%
filter(!is.na(country))
control_data <- subset(DF, condition_type == "control")
intervention_data <- subset(DF, condition_type == "intervention")
unique_labs <- unique(DF$country)
condition_names <- c("list", "letter", "text", "hk.list", "sub", "god.letter")
variables <- c(
"pa_mean", "na_mean", "optimistic_mean", "ls_mean", "ladder",
"envy_mean", "indebted_mean", "gratitude_mean", "guilty", "ss_mean"
)
#Set levels
DF$condition <- factor(DF$condition)  # convert to factor
DF$condition <- factor(DF$condition, levels = c(
"measure", "events", "int.events",     # Control
"list", "letter", "text", "hk.list", "sub", "god.letter"  # Intervention
))
DF$condition_type <- factor(DF$condition_type)  # convert to factor
DF$condition_type <- factor(DF$condition_type, levels = c("control", "intervention"))
# sanity check
interventions_test <- DF %>%
group_by(condition) %>%
summarize(
grat_mean     = mean(gratitude_mean, na.rm = TRUE),
pa_mean       = mean(pa_mean, na.rm = TRUE),
optimistic_mean = mean(optimistic_mean, na.rm = TRUE),
na_mean       = mean(na_mean, na.rm = TRUE),
indebted_mean = mean(indebted_mean, na.rm = TRUE),
envy_mean     = mean(envy_mean, na.rm = TRUE),
ls_mean       = mean(ls_mean, na.rm = TRUE),
guilty_mean       = mean(guilty, na.rm = TRUE),
ss_mean       = mean(ss_mean, na.rm = TRUE),
n             = n()
)
country_test <- DF %>%
group_by(country) %>%
summarize(
grat_mean     = mean(gratitude_mean, na.rm = TRUE),
pa_mean       = mean(pa_mean, na.rm = TRUE),
optimistic_mean = mean(optimistic_mean, na.rm = TRUE),
na_mean       = mean(na_mean, na.rm = TRUE),
indebted_mean = mean(indebted_mean, na.rm = TRUE),
envy_mean     = mean(envy_mean, na.rm = TRUE),
ls_mean       = mean(ls_mean, na.rm = TRUE),
guilty_mean       = mean(guilty, na.rm = TRUE),
ss_mean       = mean(ss_mean, na.rm = TRUE),
n             = n()
)
# Create an empty list to store results
effect_sizes <- numeric(length(variables))
names(effect_sizes) <- variables
# Loop through each variable and compute Cohen's d
for (var in variables) {
formula <- as.formula(paste(var, "~ condition_type"))
result <- cohen.d(formula, data = DF)
effect_sizes[var] <- -result$estimate  # Note the negation
}
# Assemble the results into a data frame
overall_results_df <- data.frame(
country = "NA",
control_condition = "All",
intervention_condition = "All",
contrast = "All vs. All",
t(effect_sizes),
stringsAsFactors = FALSE
)
print(overall_results_df)
# Initialize the output data frame
overall_country_results_df <- data.frame(
country = character(),
control_condition = character(),
intervention_condition = character(),
matrix(ncol = length(variables), nrow = 0,
dimnames = list(NULL, paste0(gsub("_mean", "", variables), "_effect_size"))),
stringsAsFactors = FALSE
)
# Loop through each country/lab
results_list <- lapply(unique_labs, function(lab_name) {
# Subset data for the lab
lab_data <- subset(DF, country == lab_name)
# Skip if data for this lab is missing or has only one condition
if (nrow(lab_data) < 2 || length(unique(lab_data$condition_type)) < 2) {
return(NULL)
}
# Calculate Cohen's d for each variable
effect_sizes <- sapply(variables, function(var) {
formula <- as.formula(paste(var, "~ condition_type"))
result <- cohen.d(formula, data = lab_data)
return(-result$estimate)
})
# Create a data frame row with the results
result <- data.frame(
country = lab_name,
control_condition = "All",
intervention_condition = "All",
contrast = "All vs. All",
t(effect_sizes),
stringsAsFactors = FALSE
)
return(result)
})
# Combine all non-null results
overall_country_results_df <- do.call(rbind, results_list)
# Print final result
print(overall_country_results_df)
# Initialize results data frame
unique_country_results_df <- data.frame()
# Function to compute Cohen's d and variance
compute_effect_sizes <- function(lab_name, control_cond, intervention_cond) {
# Subset data for this contrast
country_data <- DF %>% filter(country == lab_name)
control_subset <- country_data %>% filter(condition == control_cond)
intervention_subset <- country_data %>% filter(condition == intervention_cond)
# Function to calculate variance of Cohen's d
calc_var <- function(d, n1, n2) {
se_d <- sqrt((n1 + n2) / (n1 * n2) + d^2 / (2 * (n1 + n2)))
return(se_d^2)
}
# Loop through each measure and calculate d and variance
effects <- sapply(variables, function(measure) {
d_result <- cohen.d(intervention_subset[[measure]], control_subset[[measure]], pooled = TRUE)
d_value <- d_result$estimate
var_value <- calc_var(d_value, nrow(control_subset), nrow(intervention_subset))
c(d_value, var_value)
})
# Split effect sizes and variances into named vectors
effect_sizes <- effects[1, ]
variances <- effects[2, ]
# Create result row
result <- data.frame(
country = lab_name,
control_condition = control_cond,
intervention_condition = intervention_cond,
contrast = paste(control_cond, "vs", intervention_cond),
as.list(setNames(effect_sizes, paste0(gsub("_mean", "", variables), "_effect_size"))),
as.list(setNames(variances, paste0(gsub("_mean", "", variables), "_var"))),
stringsAsFactors = FALSE
)
return(result)
}
# Loop through countries and contrasts
results_list <- list()
for (lab_name in unique_labs) {
country_data <- DF %>% filter(country == lab_name)
control_conditions <- unique(country_data$condition[country_data$condition_type == "control"])
intervention_conditions <- unique(country_data$condition[country_data$condition_type == "intervention"])
for (control_cond in control_conditions) {
for (intervention_cond in intervention_conditions) {
results_list[[length(results_list) + 1]] <- compute_effect_sizes(lab_name, control_cond, intervention_cond)
}
}
}
# Combine all results
unique_country_results_df <- do.call(rbind, results_list)
# Output
print(unique_country_results_df)
# Initialize result list
results_list <- list()
# Get condition pairs
control_conditions <- unique(DF$condition[DF$condition_type == "control"])
intervention_conditions <- unique(DF$condition[DF$condition_type == "intervention"])
# Function to compute effect sizes between two conditions
compute_effect_sizes <- function(control_cond, intervention_cond) {
control_subset <- DF %>% filter(condition == control_cond)
intervention_subset <- DF %>% filter(condition == intervention_cond)
# Compute effect sizes using sapply
effect_sizes <- sapply(variables, function(measure) {
result <- cohen.d(intervention_subset[[measure]], control_subset[[measure]], pooled = TRUE)
return(result$estimate)
})
# Create data frame row
data.frame(
country = "NA",
control_condition = control_cond,
intervention_condition = intervention_cond,
contrast = paste(control_cond, "vs", intervention_cond),
as.list(setNames(effect_sizes, paste0(gsub("_mean", "", variables), "_effect_size"))),
stringsAsFactors = FALSE
)
}
# Loop over condition pairs
for (control_cond in control_conditions) {
for (intervention_cond in intervention_conditions) {
results_list[[length(results_list) + 1]] <- compute_effect_sizes(control_cond, intervention_cond)
}
}
# Combine into one data frame
unique_cond_results_df <- do.call(rbind, results_list)
# Output
print(unique_cond_results_df)
# Nest overall data by country
overall_country_nested <- overall_country_results_df %>%
group_by(country) %>%
nest()
print(overall_country_nested)
# Nest unique data by condition
unique_country_nested <- unique_country_results_df %>%
group_by(country, control_condition, intervention_condition) %>%
nest()
print(unique_country_nested)
# Nest unique data by condition
unique_condition_nested <- unique_condition_results_df %>%
group_by(control_condition, intervention_condition) %>%
nest()
# Create an empty list to store results
effect_sizes <- numeric(length(variables))
names(effect_sizes) <- variables
# Loop through each variable and compute Cohen's d
for (var in variables) {
formula <- as.formula(paste(var, "~ condition_type"))
result <- cohen.d(formula, data = DF)
effect_sizes[var] <- -result$estimate  # Note the negation
}
# Assemble the results into a data frame
overall_results_df <- data.frame(
country = "NA",
control_condition = "All",
intervention_condition = "All",
contrast = "All vs. All",
t(effect_sizes),
stringsAsFactors = FALSE
)
print(overall_results_df)
# Initialize the output data frame
overall_country_results_df <- data.frame(
country = character(),
control_condition = character(),
intervention_condition = character(),
matrix(ncol = length(variables), nrow = 0,
dimnames = list(NULL, paste0(gsub("_mean", "", variables), "_effect_size"))),
stringsAsFactors = FALSE
)
# Loop through each country/lab
results_list <- lapply(unique_labs, function(lab_name) {
# Subset data for the lab
lab_data <- subset(DF, country == lab_name)
# Skip if data for this lab is missing or has only one condition
if (nrow(lab_data) < 2 || length(unique(lab_data$condition_type)) < 2) {
return(NULL)
}
# Calculate Cohen's d for each variable
effect_sizes <- sapply(variables, function(var) {
formula <- as.formula(paste(var, "~ condition_type"))
result <- cohen.d(formula, data = lab_data)
return(-result$estimate)
})
# Create a data frame row with the results
result <- data.frame(
country = lab_name,
control_condition = "All",
intervention_condition = "All",
contrast = "All vs. All",
t(effect_sizes),
stringsAsFactors = FALSE
)
return(result)
})
# Combine all non-null results
overall_country_results_df <- do.call(rbind, results_list)
# Print final result
print(overall_country_results_df)
# Initialize results data frame
unique_country_results_df <- data.frame()
# Function to compute Cohen's d and variance
compute_effect_sizes <- function(lab_name, control_cond, intervention_cond) {
# Subset data for this contrast
country_data <- DF %>% filter(country == lab_name)
control_subset <- country_data %>% filter(condition == control_cond)
intervention_subset <- country_data %>% filter(condition == intervention_cond)
# Function to calculate variance of Cohen's d
calc_var <- function(d, n1, n2) {
se_d <- sqrt((n1 + n2) / (n1 * n2) + d^2 / (2 * (n1 + n2)))
return(se_d^2)
}
# Loop through each measure and calculate d and variance
effects <- sapply(variables, function(measure) {
d_result <- cohen.d(intervention_subset[[measure]], control_subset[[measure]], pooled = TRUE)
d_value <- d_result$estimate
var_value <- calc_var(d_value, nrow(control_subset), nrow(intervention_subset))
c(d_value, var_value)
})
# Split effect sizes and variances into named vectors
effect_sizes <- effects[1, ]
variances <- effects[2, ]
# Create result row
result <- data.frame(
country = lab_name,
control_condition = control_cond,
intervention_condition = intervention_cond,
contrast = paste(control_cond, "vs", intervention_cond),
as.list(setNames(effect_sizes, paste0(gsub("_mean", "", variables), "_effect_size"))),
as.list(setNames(variances, paste0(gsub("_mean", "", variables), "_var"))),
stringsAsFactors = FALSE
)
return(result)
}
# Loop through countries and contrasts
results_list <- list()
for (lab_name in unique_labs) {
country_data <- DF %>% filter(country == lab_name)
control_conditions <- unique(country_data$condition[country_data$condition_type == "control"])
intervention_conditions <- unique(country_data$condition[country_data$condition_type == "intervention"])
for (control_cond in control_conditions) {
for (intervention_cond in intervention_conditions) {
results_list[[length(results_list) + 1]] <- compute_effect_sizes(lab_name, control_cond, intervention_cond)
}
}
}
# Combine all results
unique_country_results_df <- do.call(rbind, results_list)
# Output
print(unique_country_results_df)
# Initialize result list
results_list <- list()
# Get condition pairs
control_conditions <- unique(DF$condition[DF$condition_type == "control"])
intervention_conditions <- unique(DF$condition[DF$condition_type == "intervention"])
# Function to compute effect sizes between two conditions
compute_effect_sizes <- function(control_cond, intervention_cond) {
control_subset <- DF %>% filter(condition == control_cond)
intervention_subset <- DF %>% filter(condition == intervention_cond)
# Compute effect sizes using sapply
effect_sizes <- sapply(variables, function(measure) {
result <- cohen.d(intervention_subset[[measure]], control_subset[[measure]], pooled = TRUE)
return(result$estimate)
})
# Create data frame row
data.frame(
country = "NA",
control_condition = control_cond,
intervention_condition = intervention_cond,
contrast = paste(control_cond, "vs", intervention_cond),
as.list(setNames(effect_sizes, paste0(gsub("_mean", "", variables), "_effect_size"))),
stringsAsFactors = FALSE
)
}
# Loop over condition pairs
for (control_cond in control_conditions) {
for (intervention_cond in intervention_conditions) {
results_list[[length(results_list) + 1]] <- compute_effect_sizes(control_cond, intervention_cond)
}
}
# Combine into one data frame
unique_cond_results_df <- do.call(rbind, results_list)
# Output
print(unique_cond_results_df)
# Nest overall data by country
overall_country_nested <- overall_country_results_df %>%
group_by(country) %>%
nest()
print(overall_country_nested)
# Nest unique data by condition
unique_country_nested <- unique_country_results_df %>%
group_by(country, control_condition, intervention_condition) %>%
nest()
print(unique_country_nested)
# Nest unique data by condition
unique_condition_nested <- unique_cond_results_df %>%
group_by(control_condition, intervention_condition) %>%
nest()
print(unique_condition_nested)
write.csv(overall_results_df,
file = here('data',
"overall_effect_sizes.csv"))
write.csv(overall_country_results_df,
file = here('data',
"overall_country_effect_sizes.csv"))
write.csv(unique_country_results_df,
file = here('data',
"unique_country_effect_sizes.csv"))
write.csv(unique_cond_results_df,
file = here('data',
"unique_cond_effect_sizes.csv"))
