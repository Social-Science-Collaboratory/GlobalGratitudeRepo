tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# write to csv
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# write to csv
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_full,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
results_df <- results_df[, c("outcome", "condition", "estimate", "ci_lower", "ci_upper")]
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_en,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_qc,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# write to csv
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
View(ef_combined)
View(ef_combined)
n_full <- "10,772"
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_full,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
results_df <- results_df[, c("outcome", "condition", "estimate", "ci_lower", "ci_upper")]
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_en,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_qc,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
View(ef_combined)
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# effect size estimates for all data
results_df <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_full,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
results_df <- results_df[, c("outcome", "condition", "estimate", "ci_lower", "ci_upper")]
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_en,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_qc,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
View(ef_combined)
results_df <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_full,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results_df)
View(results_df)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
results_df <- results_df[, c("outcome", "condition", "estimate", "ci_lower", "ci_upper")]
View(results_df)
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# effect size estimates for all data
results_df <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_full,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results_df)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_en,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
n = n_qc,
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
View(ef_combined)
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# write to csv
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
View(apa_df)
# effect size estimates for all data
results_df <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results_df)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
# Format effect sizes and taus
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
# Remove leading zeros for APA
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
# Create CI column
CI = paste0("[", ci_lower, ", ", ci_upper, "]"),
# Add sample size per condition
n = dplyr::case_when(
condition == "Full" ~ nrow(EN_unique_country_results_df),
condition == "Excluding potentially problematic participants" ~ nrow(EN_unique_country_results_df %>% filter(!problematic_participant)),
condition == "Excluding non-English surveys" ~ nrow(EN_unique_country_results_df %>% filter(language == "English"))
)
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
n,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
# Format effect sizes and taus
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
# Remove leading zeros for APA
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
# Create CI column
CI = paste0("[", ci_lower, ", ", ci_upper, "]"),
# Add sample size per condition
n = dplyr::case_when(
condition == "Full" ~ n_full,
condition == "Excluding potentially problematic participants" ~ n_qc,
condition == "Excluding non-English surveys" ~ n_en))
)
# Full sample
n_full <- "10,772"
# Excluding problematic participants
n_qc <- "9,617"
# Excluding non-English surveys
n_en <- "6,836"
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
# Format effect sizes and taus
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
# Remove leading zeros for APA
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
# Create CI column
CI = paste0("[", ci_lower, ", ", ci_upper, "]"),
# Add sample size per condition
n = dplyr::case_when(
condition == "Full" ~ n_full,
condition == "Excluding potentially problematic participants" ~ n_qc,
condition == "Excluding non-English surveys" ~ n_en
)
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
n,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# Write to CSV
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
style_project()
# load packages
source("setup.R")
style_project()
install.packages("styler")
style_project()
style_project()
