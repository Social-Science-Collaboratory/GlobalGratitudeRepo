ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
qc_estimate = est,
qc_ci_lower = ci_lower,
qc_ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df <- qc_results_df[, c("outcome", "qc_estimate", "qc_ci_lower", "qc_ci_upper")]
# Add condition labels
en_results_df$condition <- "Excluding non-English surveys"
qc_results_df$condition <- "Excluding potentially problematic participants"
# calculate ratios for English tau analyses
en_tau <- data.frame(
effect_size = effect_size_columns,
en_c = en_tau_c,
en_p = en_tau_p,
en_ci = en_tau_c / en_tau_p,
condition = "Excluding non-English surveys",
stringsAsFactors = FALSE
)
# calculate ratios for quality check tau analyses
qc_tau <- data.frame(
effect_size = effect_size_columns,
qc_c = qc_tau_c,
qc_p = qc_tau_p,
qc_ci = qc_tau_c / qc_tau_p,
condition = "Excluding potentially problematic participants",
stringsAsFactors = FALSE
)
# Suppose all_tau_c/p was your "Full" sample
all_tau <- data.frame(
effect_size = effect_size_columns,
all_c = all_tau_c,
all_p = all_tau_p,
all_ci = all_tau_c / all_tau_p,
condition = "Full"
)
# Bind them together
tau_combined <- dplyr::bind_rows(all_tau, qc_tau, en_tau)
# Reorder columns so condition is up front
tau_combined <- tau_combined[, c("effect_size", "condition", setdiff(names(tau_combined), c("effect_size", "condition")))]
write.csv(tau_combined,
file = here(
"quality-checks/sensitivity-analyses",
"tau_sensitivity_analyses.csv"
)
)
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
effect_size = effect_size_columns,
condition = "Excluding non-English surveys",
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
effect_size = effect_size_columns,
condition = "Full",
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
View(results)
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df <- results_df[, c("outcome", "estimate", "ci_lower", "ci_upper")]
View(results_df)
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df <- results_df[, c("outcome", "estimate", "ci_lower", "ci_upper")]
View(results_df)
results_df$condition <- "Full"
View(results_df)
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
en_estimate = est,
en_ci_lower = ci_lower,
en_ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df <- en_results_df[, c("outcome", "en_estimate", "en_ci_lower", "en_ci_upper")]
en_results_df$condition <- "Excluding non-English surveys"
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
qc_estimate = est,
qc_ci_lower = ci_lower,
qc_ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df <- qc_results_df[, c("outcome", "qc_estimate", "qc_ci_lower", "qc_ci_upper")]
qc_results_df$condition <- "Excluding potentially problematic participants"
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
View(ef_combined)
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$effect_size <- names(m.ic)
results_df <- results_df[, c("effect_size", "estimate", "ci_lower", "ci_upper")]
results_df$condition <- "Full"
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
en_estimate = est,
en_ci_lower = ci_lower,
en_ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$effect_size <- names(en.m.ic)
en_results_df <- en_results_df[, c("effect_size", "en_estimate", "en_ci_lower", "en_ci_upper")]
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
qc_estimate = est,
qc_ci_lower = ci_lower,
qc_ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$effect_size <- names(qc.m.ic)
qc_results_df <- qc_results_df[, c("effect_size", "qc_estimate", "qc_ci_lower", "qc_ci_upper")]
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
# Reorder columns so condition is up front
ef_combined <- ef_combined[, c("effect_size", "condition", setdiff(names(ef_combined), c("effect_size", "condition")))]
View(ef_combined)
write.csv(results_df,
file = here(
"quality-checks/sensitivity-analyses",
"ef_sensitivity_analyses.csv"
)
)
# calculate ratios for English tau analyses
en_tau <- data.frame(
outcome = effect_size_columns,
en_c = en_tau_c,
en_p = en_tau_p,
en_ci = en_tau_c / en_tau_p,
condition = "Excluding non-English surveys",
stringsAsFactors = FALSE
)
# calculate ratios for quality check tau analyses
qc_tau <- data.frame(
outcome = effect_size_columns,
qc_c = qc_tau_c,
qc_p = qc_tau_p,
qc_ci = qc_tau_c / qc_tau_p,
condition = "Excluding potentially problematic participants",
stringsAsFactors = FALSE
)
# Suppose all_tau_c/p was your "Full" sample
all_tau <- data.frame(
outcome = effect_size_columns,
all_c = all_tau_c,
all_p = all_tau_p,
all_ci = all_tau_c / all_tau_p,
condition = "Full"
)
# Bind them together
tau_combined <- dplyr::bind_rows(all_tau, qc_tau, en_tau)
# Reorder columns so condition is up front
tau_combined <- tau_combined[, c("outcome", "condition", setdiff(names(tau_combined), c("outcome", "condition")))]
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df <- results_df[, c("outcome", "estimate", "ci_lower", "ci_upper")]
results_df$condition <- "Full"
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
en_estimate = est,
en_ci_lower = ci_lower,
en_ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df <- en_results_df[, c("outcome", "en_estimate", "en_ci_lower", "en_ci_upper")]
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
qc_estimate = est,
qc_ci_lower = ci_lower,
qc_ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df <- qc_results_df[, c("outcome", "qc_estimate", "qc_ci_lower", "qc_ci_upper")]
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
# Reorder columns so condition is up front
ef_combined <- ef_combined[, c("outcome", "condition", setdiff(names(ef_combined), c("outcome", "condition")))]
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
View(combined_df)
write_csv(combined_df, here("quality-checks", "sensitivity-analyses/sensitivity_analyses.csv"))
style_project()
write_csv(combined_df, here("quality-checks", "sensitivity-analyses/si_table_4"))
style_project()
write_csv(combined_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
mutate(
# Round values
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ratio = sprintf("%.2f", tau_ratio),
# Remove leading zero for APA style
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ratio),
~ sub("^0", "", .x)),
# Format CI into single column
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
select(
Outcome = outcome,
Sample = condition,
n,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ratio
)
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
results_df <- results_df[, c("outcome", "condition", "estimate", "ci_lower", "ci_upper")]
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
en_estimate = est,
en_ci_lower = ci_lower,
en_ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
qc_estimate = est,
qc_ci_lower = ci_lower,
qc_ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
View(ef_combined)
en_tau <- data.frame(
outcome = effect_size_columns,
tau_c = en_tau_c,
tau_p = en_tau_p,
tau_ci = en_tau_c / en_tau_p,
condition = "Excluding non-English surveys"
)
qc_tau <- data.frame(
outcome = effect_size_columns,
tau_c = qc_tau_c,
tau_p = qc_tau_p,
tau_ci = qc_tau_c / qc_tau_p,
condition = "Excluding potentially problematic participants"
)
all_tau <- data.frame(
outcome = effect_size_columns,
tau_c = all_tau_c,
tau_p = all_tau_p,
tau_ci = all_tau_c / all_tau_p,
condition = "Full"
)
tau_combined <- dplyr::bind_rows(all_tau, qc_tau, en_tau)
View(tau_combined)
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
View(combined_df)
apa_df <- combined_df %>%
dplyr::mutate(
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
View(apa_df)
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
style_project()
View(en_results)
View(en_results)
# effect size estimates for all data
results <- lapply(m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
results_df <- do.call(rbind, results)
results_df$outcome <- names(m.ic)
results_df$condition <- "Full"
results_df <- results_df[, c("outcome", "condition", "estimate", "ci_lower", "ci_upper")]
# effect size estimates for quality check data
en_results <- lapply(en.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
en_results_df <- do.call(rbind, en_results)
en_results_df$outcome <- names(en.m.ic)
en_results_df$condition <- "Excluding non-English surveys"
# effect size estimates for quality check data
qc_results <- lapply(qc.m.ic, function(model) {
est <- as.numeric(coef(model)) # pooled estimate (intercept)
se <- sqrt(diag(vcov(model)))[1] # SE of intercept
ci_lower <- est - 1.96 * se
ci_upper <- est + 1.96 * se
data.frame(
estimate = est,
ci_lower = ci_lower,
ci_upper = ci_upper
)
})
qc_results_df <- do.call(rbind, qc_results)
qc_results_df$outcome <- names(qc.m.ic)
qc_results_df$condition <- "Excluding potentially problematic participants"
# Bind them together
ef_combined <- dplyr::bind_rows(results_df, qc_results_df, en_results_df)
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# write to csv
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
# combine
combined_df <- ef_combined %>%
inner_join(tau_combined, by = c("outcome", "condition"))
apa_df <- combined_df %>%
dplyr::mutate(
estimate = sprintf("%.2f", estimate),
ci_lower = sprintf("%.2f", ci_lower),
ci_upper = sprintf("%.2f", ci_upper),
tau_c = sprintf("%.3f", tau_c),
tau_p = sprintf("%.3f", tau_p),
tau_ci = sprintf("%.2f", tau_ci),
across(c(estimate, ci_lower, ci_upper, tau_c, tau_p, tau_ci),
~ sub("^0", "", .x)),
CI = paste0("[", ci_lower, ", ", ci_upper, "]")
) %>%
dplyr::select(
Outcome = outcome,
Sample = condition,
`Cohen's d` = estimate,
`95% CI` = CI,
τc = tau_c,
τp = tau_p,
`τc/τp` = tau_ci
)
# write to csv
write_csv(apa_df, here("quality-checks", "sensitivity-analyses/si_table_4.csv"))
n_full <- nrow(EN_unique_country_results_df)
# Excluding problematic participants
n_qc <- nrow(EN_unique_country_results_df %>% filter(!problematic_participant))
