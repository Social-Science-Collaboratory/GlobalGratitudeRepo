install.packages(c("httr", "jsonlite", "dplyr"))
library(httr)
library(jsonlite)
library(dplyr)
# Base API URL for works
base_url <- "https://api.openalex.org/works"
# Your query (experimental example)
query_exp <- 'title:"cross-cultural" OR
title:"cross cultural" OR
title:"cross-national" OR
title:"cross national" OR
title:"multinational" OR
title:"international comparison" OR
title:"cross country" OR
title:"cross-country" OR
title:"multi-country" OR
title:"international sample" OR
title:"multi-site" OR
title:"multi-national"
AND
title:"experiment" OR
title:"experimental" OR
title:"laboratory study" OR
title:"field experiment" OR
title:"randomized" OR
title:"randomised" OR
title:"RCT"'
query_exp_encoded <- URLencode(query_exp)
# Filter for year, field, and type
# Example: field ID for Psychology: C_71 (replace with actual OpenAlex concept ID if needed)
full_url <- paste0(
base_url,
"?filter=type:journal-article,publication_year:2010-2024,concepts.id:C_71,abstract.search:",
query_exp_encoded,
"&per-page=200"
)
# GET request
res <- GET(full_url)
status_code(res)  # check response
# Parse JSON
data_json <- content(res, as="text", encoding="UTF-8")
data_list <- fromJSON(data_json, flatten = TRUE)
# Extract data
papers <- data_list$data %>%
select(id, title, publication_date, primary_location.country_code,
authorship_consortium, concept_labels, doi,
host_venue.display_name, cited_by_count)
library(tidyverse)
# Extract data
papers <- data_list$data %>%
select(id, title, publication_date, primary_location.country_code,
authorship_consortium, concept_labels, doi,
host_venue.display_name, cited_by_count)
View(data_list)
# GET request
res <- GET(full_url)
status_code(res)  # check response
query_exp_encoded <- URLencode(query_exp)
# Filter for year, field, and type
# Example: field ID for Psychology: C_71 (replace with actual OpenAlex concept ID if needed)
full_url <- paste0(
base_url,
"?filter=type:journal-article,publication_year:2010-2024,concepts.display_name:Psychology,abstract.search:",
query_exp_encoded,
"&per-page=200"
)
res <- GET(full_url)
status_code(res)  # check response
data_json <- content(res, as="text", encoding="UTF-8")
data_list <- fromJSON(data_json, flatten = TRUE)
View(data_list)
data_list[["message"]]
full_url <- paste0(
base_url,
"?filter=type:journal-article,publication_year:2000-2024,concepts.id:C_71,abstract.search:",
query_exp_encoded,
"&per-page=200"
)
View(data_list)
full_url <- paste0(
base_url,
"?filter=type:journal-article,publication_year:2000-2024",
query_exp_encoded,
"&per-page=200"
)
res <- GET(full_url)
status_code(res)  # check response
data_json <- content(res, as="text", encoding="UTF-8")
data_list <- fromJSON(data_json, flatten = TRUE)
View(data_list)
res <- GET(query_exp_encoded)
# Cross-Country Psychology OpenAlex Pull
# ==========================
# Load required packages
library(httr)
library(jsonlite)
library(dplyr)
# Base URL
base_url <- "https://api.openalex.org/works"
# --------------------------
# Define Queries
# --------------------------
# 1. Experimental studies
query_exp <- '(
title:"cross-cultural" OR title:"cross cultural" OR title:"cross-national" OR title:"cross national" OR
title:"multinational" OR title:"international comparison" OR title:"cross country" OR title:"cross-country" OR
title:"multi-country" OR title:"international sample" OR title:"multi-site" OR title:"multi-national"
) AND (
title:"experiment" OR title:"experimental" OR title:"laboratory study" OR title:"field experiment" OR
title:"randomized" OR title:"randomised" OR title:"RCT"
) NOT (
title:"clinical trial" OR title:"drug" OR title:"therapy" OR title:"patients" OR title:"marketing" OR title:"business administration"
)'
# 2. Survey/Correlational studies
query_survey <- '(
title:"cross-cultural" OR title:"cross cultural" OR title:"cross-national" OR title:"cross national" OR
title:"multinational" OR title:"international comparison" OR title:"cross country" OR title:"cross-country" OR
title:"multi-country" OR title:"international sample" OR title:"multi-site"
) AND (
title:"survey" OR title:"questionnaire" OR title:"observational" OR title:"correlational" OR
title:"study" OR title:"data collection" OR title:"assessment"
) NOT (
title:"clinical trial" OR title:"drug" OR title:"therapy" OR title:"patients" OR title:"marketing" OR title:"business administration"
)'
# --------------------------
# Function to Pull All Pages
# --------------------------
pull_openalex <- function(query, per_page = 200, years = "2000-2024", field = "Psychology") {
all_results <- list()
cursor <- "*"
repeat {
# Construct URL
full_url <- paste0(
base_url,
"?filter=type:journal-article,publication_year:", years,
",concepts.display_name:", field,
",abstract.search:", URLencode(query),
"&per-page=", per_page,
"&cursor=", cursor
)
res <- GET(full_url)
if (status_code(res) != 200) {
stop("Error: ", status_code(res))
}
data_json <- content(res, as = "text", encoding = "UTF-8")
data_list <- fromJSON(data_json, flatten = TRUE)
all_results <- append(all_results, list(data_list$data))
# Check for next page
if (is.null(data_list$meta$next_cursor)) break
cursor <- data_list$meta$next_cursor
Sys.sleep(1)  # polite delay to avoid rate limiting
}
# Combine into one dataframe
df <- bind_rows(all_results)
# Select key columns
df <- df %>%
select(
id, title, publication_date,
authorship_consortium, concept_labels, doi,
host_venue.display_name, cited_by_count,
authorships.institutions.country_code
)
return(df)
}
# --------------------------
# Pull Data
# --------------------------
# Experimental papers
exp_df <- pull_openalex(query_exp)
#load packages
source("setup.R")
getwd()
